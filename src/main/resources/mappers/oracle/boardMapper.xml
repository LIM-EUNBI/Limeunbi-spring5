<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="boardMapper">
<!-- bno필드 변수가 자동증가가 되는 기능이 필요 -->

<insert id="insertBoard">
	<selectKey keyProperty="bno" resultType="int" order="BEFORE">
	select seq_bno.nextval from dual
	</selectKey>
	insert into tbl_board (
		bno, board_type, content, reg_date, title, writer
	) values (
		#{bno},#{board_type},#{content},systimestamp,#{title},#{writer}
	)
</insert>

<select id="selectBoard" resultType="com.edu.vo.BoardVO">
select table_b.* from
	select rownum as rnum, table_a.* from (
		select * from tbl_board
		<include refid="sqlWhere" />
	) table_a
	<![CDATA[	
	where rownum <= (#{queryStartNo}*#{queryperPageNum})+#{queryPerPageNum}
) table_b where table_b.rnum > #{queryStartNo}*#{queryPerPageNum}
]]>
</select>

<!-- 검색처리 : 멤버쿼리에서 작성한 내용 붙여넣기 -->
<sql id="sqlWhere">
	<if test="search_type != '' and search_type != null">
    WHERE
    	board_type = #{board_type}    
       	<if test="search_type == 'all'.toString()">
      			title LIKE '%'||#{search_keyword}||'%'
       		OR content LIKE '%'||#{search_keyword}||'%'
       	</if>
       	<if test="search_type == 'title'.toString()">
       		title LIKE '%'||#{search_keyword}||'%'
       
       	</if>
       	<if test="search_type == 'content'.toString()">
				content LIKE '%'||#{search_keyword}||'%'
       	</if>
	</if>
</sql>
</mapper>